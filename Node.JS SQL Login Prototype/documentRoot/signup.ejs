<!DOCTYPE html>
<html>
<head>
        <title>Prototype HTML Login</title>
        <style>
                label{
                        font-size: 150%;
                }
                input{
                        font-size: 150%;
                }
                #errorLabel{
                        color:red;
                }
                #myProgress {
                        margin: 0 auto;
                        width: 300px;
                        background-color: grey;
                }

                #myBar {
                        width: 1%;
                        height: 30px;
                        background-color: green;
                }
        </style>
        <script>
                let i = 0;
                let passwordsMatch = true;
                let formsFilled = false;
                let globalpasswordStrength = true;
                function ifChanged(){
                        if(document.getElementById("firstname").value.length > 0 &&
                        document.getElementById("lastname").value.length > 0 &&
                        document.getElementById("email").value.length > 0 &&
                        document.getElementById("username").value.length > 0 &&
                        document.getElementById("create_password").value.length > 0){
                                formsFilled = true;
                                if(passwordsMatch && globalpasswordStrength === true){
                                        document.getElementById("submitButton").disabled = false; 
                                }
                        }else{
                                document.getElementById("submitButton").disabled = true; 
                                formsFilled = false;
                        }
                }
                
                function run() {
                        let p1 = document.getElementById("create_password").value;
                        let p2 = document.getElementById("confirm_password").value;
                        if(p1 === p2){
                                document.getElementById("errorLabel").innerHTML = "";
                                passwordsMatch = true;
                                if(passwordsMatch && globalpasswordStrength === true && formsFilled){
                                        document.getElementById("submitButton").disabled = false; 
                                }

                        }else{
                                document.getElementById("errorLabel").innerHTML = "Passwords do not match";
                                passwordsMatch = false;
                        }
                }
                
                function passwordStrength(){
                        let numbers = true;
                        let spChar = true;
                        let capital = true;
                        let tempVal = document.getElementById("create_password").value.length*10;
                        
                        if(document.getElementById("create_password").value.length*10 > 100){
                                tempVal=100;
                        }
                        document.getElementById("myBar").style.width = (tempVal) + "%";
                        if(tempVal < 80){
                                disableButton = true;
                        }
                        let pattern = new RegExp(/[~`!#$%\^&*+=\-\@#$%^[\]\\';,/{}|\\":<>\?]/);
                        if (!pattern.test(document.getElementById("create_password").value)) {
                                if(!document.getElementById("spchar")){
                                        createErrorMessage("Please use at least 1 special character","spchar");
                                }
                                numbers = false;
                        }else{
                                if(document.getElementById("spchar")){
                                        document.getElementById("spchar").remove();
                                }
                        }
                        let pattern2 = new RegExp(/\d/); //unacceptable chars
                        if (!pattern2.test(document.getElementById("create_password").value)) {
                                if(!document.getElementById("numbers")){
                                        createErrorMessage("Please use at least 1 number","numbers");
                                }
                                spChar = false;
                        }else{
                                if(document.getElementById("numbers")){
                                        document.getElementById("numbers").remove();
                                }
                        }
                        let pattern3 = new RegExp(/[A-Z]/); //unacceptable chars
                        if (!pattern3.test(document.getElementById("create_password").value)) {
                                if(!document.getElementById("captial")){
                                        createErrorMessage("Please use at least 1 Upper case letter","captial");
                                }
                                capital = false;
                        }else{
                                if(document.getElementById("captial")){
                                        document.getElementById("captial").remove();
                                }
                        }
                        if(numbers === false || capital === false || spChar=== false){
                                document.getElementById("myBar").style.backgroundColor = "red";
                                document.getElementById("submitButton").disabled = true;
                                globalpasswordStrength = false;
                        }else{
                                globalpasswordStrength = true;
                                if(passwordsMatch && formsFilled){
                                        document.getElementById("submitButton").disabled = false;
                                }
                                document.getElementById("myBar").style.backgroundColor = "green";
                        }
                }
                function createErrorMessage(message,elementID){
                        if(!document.getElementById(elementID)){
                                        let errorMsg = document.createElement("p");
                                        errorMsg.innerHTML = message;
                                        errorMsg.style.color = "red";
                                        errorMsg.id = elementID;
                                        insertAfter(document.getElementById("errorMsgs"),errorMsg);
                        }
                }
                function insertAfter(referenceNode, newNode) {
                        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
                }
        </script>
</head>
<body>
        
        <center style="padding-top:200px;">
                <h1>Signup Page</h1>
                <%if(userExists == "true") { %>
                        <h2 style="color:red;">Username is taken</h2>
                        <%}%>
                <form method="POST" action="/submit-form-signup" id="signupForm">
                        <label for="firstname" >First Name:</label><br>
                        <input type="text" name="first_name" id="firstname" oninput="ifChanged()"/><br>
                        <label for="lastname">Last Name:</label><br>
                        <input type="text" name="last_name"  id="lastname" oninput="ifChanged()"/><br>
                        <label for="text"  method="POST">New Username:</label><br>
                        <input type="text" name="create_username" id="username" oninput="ifChanged()"/><br>
                        <label for="email" >Email Address:</label><br>
                        <input type="text" name="email" id = "email" oninput="ifChanged()"/><br>
                        <label for="password">Create Password:</label><br>
                        <input type="password" name="create_password" oninput="run(); passwordStrength(); ifChanged();" id="create_password"/><br>
                        <label id="errorMsgs">Password Strength</label>
                </center>
                        <div id="myProgress">
                                <div id="myBar"></div>
                              </div>
                 <center>
                              <label for="password">Confirm Password:</label><br>
                        <label for="errorLabel" id="errorLabel"></label><br>
                        <input type="password" name="confirm_password" oninput="run()" id="confirm_password"/><br>
                        <input type="submit" id="submitButton" disabled="true"/>
                </form>
        </center>



</body>
</html>
